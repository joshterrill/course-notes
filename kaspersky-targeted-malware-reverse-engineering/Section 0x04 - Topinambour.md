### History
TODO

### Dropper Analysis
1. Load the dropper into **dnspy** for analysis, you should see a new file get created called topinambour.exe. 
2. We see in the disassembler in the `make_some_noise()` function that it starts a scheduled task called *VerifiedPublisherCertCheck*.  
![[topinambour-1.png]]
4. We can grab the payloads for `original` and `payload` from the *Resources* section of the file. Saving them to their own binaries and loading them into  **dnspy** as well to get more information like the C2 IP addresses. Also in the resources section is the filename that gets dropped, which is *TeamView_Setup_ru.exe*
5. In the client file payload extract, we see some IP's and a port of 13277.
![[topinambour-2.png]]

## Gathering file and network IOC's
First thing we can do is load up **FAR Manager**, navigate to the `payload` sample and press F3 to view it.

![[topinambour-3.png]]

We see in the header that it looks to be some sort of PE file, but when we press F4 -> Hex Mode, then F8 to view Headers and F7 to view imports, we only see one import which is very strange. No imports from user32, kernel32, etc. 

Opening `payload` in **dnspy** we see that there is in fact only one main function, that has some IP's, some ports, and what looks to be like some sort of decryption method. So it looks like it would connect to whatever the current IP in the loop is, and then it gets the response, and builds a string that eventually gets passed into `Client.GetResponseTo` which sends the commands to `cmd.exe /c` in a hidden command prompt window.

![[topinambour-4.png]]

The C2 server drops a javascript file onto the machine that is highly obfuscated. We can open it up in Notepad++, toggle WordWrap to view it easier, and then start looking for Base64 strings to parse. You'll get something like this:

![[topinambour-5.png]]

This command looks like it creates an array of a list of commands to run that gets information about the host, and then it runs each comment through `cmd.exe /c`

In the second block of base64, we see that there's a call to a method called `f_CreateScheduledTaskLogin` which has a parameter called `-scan Kdw6gG7cpOSZsBeH`

The third block appears to be a decryption method that has some encrypted text that is ran through layers of decryption. We can take this code and run it through a browser javascript console to see what it outputs.

When we try to run it, we see that it looks like it's supposed to be run with the Windows tool **WScript.exe**. If we take that part out and, add the rest of the decryption functions to the console, and then call each step of the initiating `H6uG` function, we get an output that shows us a lot of things, including a C2 domain of `txflasher.com`

![[topinambour-6.png]]

## Knowledge Check

Please analyze RocketMan trojan f77e20ef7e009c02e5194e9b102f045c by yourself to answer the following questions.

Q1. What is the specific system registry value name in use, which could help to determine the infection scope?
_lfStrikeOut_

Q2. What is the C2 IP in this case?
_64.251.26.157_

Q3. Why did the authors change the timestamps in the dropped file properties?
_They try to hide the new file among others in case of incident response._

## Checkpoint Quiz
Please analyze RocketMan trojan 7112687D3E99D0E8380B5A81ACB87EA5 by yourself to answer the following questions.

Q1. Now, near the start you see the meaning of lsStrikeOut registry value. What does it keep?
_The C2 IP and port._

Q2. Which protocol uses the trojan?
_HTTP_

Q3. What is the initial beacon in this case?
_MiamiBeach_

Q4. What is the encryption algorithm onboard?
_Rc4_

![[topinambour-7.png]]



## Questions
Q1. Which IoC besides file name, could you provide to the Incident Response team?
_No other reliable IoCs so far._

Q2. What is the task name used for persistence?
_VerifiedPublisherCertCheck_

Q3. Please do the same fast analysis and resource dumping for unpack_o() as we did together with unpack_p(). Which new file would appear in this case?
_TeamViewer_Setup_ru.exe_

Q1. What is the C2 port to connect?
_13277_

Q2. What is the file system IoC here in finger printing script?
_x5ct235.dat_

Q1. What is the value of the scan parameter for Chkdsk.js? We would need it later for decryption.
_Kdw6gG7cpOSZsBeH_

Q2. What is the C2 web domain?
_Provide answers without http(s) or www._
